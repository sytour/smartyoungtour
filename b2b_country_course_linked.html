<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDEoEvrhTfLaqtqR1Bva_pIbskWl5Ah0CE",
    authDomain: "smartyoungtour.firebaseapp.com",
    projectId: "smartyoungtour",
    storageBucket: "smartyoungtour.firebasestorage.app",
    messagingSenderId: "615207664322",
    appId: "1:615207664322:web:ea2d05fefa56e81c43595b",
    measurementId: "G-KN3EQNZWLN"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function loadCourses() {
    const snapshot = await getDocs(collection(db, "courses"));
    const courseList = [];

    snapshot.forEach((docSnap) => {
      const data = docSnap.data();
      courseList.push(data);
    });

    return courseList;
  }

  async function updateCourseOptions() {
    const country = document.getElementById('country').value;
    const courseSelect = document.getElementById('course');
    courseSelect.innerHTML = '<option value="">코스 선택</option>';

    const allCourses = await loadCourses();
    const filtered = allCourses.filter(item => item.country === country);

    filtered.forEach(item => {
      const option = document.createElement('option');
      option.value = item.course;
      option.textContent = item.course;
      courseSelect.appendChild(option);
    });
  }

  window.goToEstimate = function() {
    const country = document.getElementById('country').value;
    const course = document.getElementById('course').value;

    if (!country || !course) {
      alert('국가와 코스를 모두 선택해주세요.');
      return;
    }

    const url = `b2b_estimate_with_course.html?course=${encodeURIComponent(course)}&country=${encodeURIComponent(country)}&itinerary=자동 일정 표시`;
    window.location.href = url;
  };

  // ✨ ✨ ✨ 추가: 페이지 열리면 자동으로 Firebase 데이터 준비
  window.onload = function() {
    updateCourseOptions();
  };
</script>
